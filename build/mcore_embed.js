var mcore={};(function(f){f(document).ready(function(){f("body").append('<div id="mcore-overlay"></div><div id="mcore-embed" class="mcore-clearfix"><div class="mcore-header"><div class="mcore-pagination"><span class="mcore-btn mcore-prev"></span><span class="mcore-btn mcore-next"></span></div><div class="mcore-btn mcore-close"><span>Close</span></div><div class="mcore-title">MediaCore</div></div><form class="mcore-search" name="mcore-search"><div class="mcore-clear-search"></div><input type="text" class="mcore-search-field" value="Search" /></form><div class="mcore-content"></div><div class="mcore-message"><h2></h2><p></p></div><div class="mcore-loading"></div><div class="mcore-footer"></div></div>');mcore.mcoreEmbed=f("#mcore-embed");mcore.mcoreOverlay=f("#mcore-overlay");mcore.mcoreButton=f(".mceToolbar #content_mcore.mce_mcore");mcore.mcoreClose=mcore.mcoreEmbed.find(".mcore-close");mcore.mcorePrev=mcore.mcoreEmbed.find(".mcore-prev");mcore.mcoreNext=mcore.mcoreEmbed.find(".mcore-next");mcore.mcoreSearchForm=mcore.mcoreEmbed.find(".mcore-search");mcore.mcoreSearch=mcore.mcoreEmbed.find(".mcore-search-field");mcore.mcoreClearSearch=mcore.mcoreEmbed.find(".mcore-clear-search");mcore.contentPanel=mcore.mcoreEmbed.find(".mcore-content");mcore.footer=mcore.mcoreEmbed.find(".mcore-footer");mcore.message=mcore.mcoreEmbed.find(".mcore-message");mcore.loading=mcore.mcoreEmbed.find(".mcore-loading");mcore.url=b(global_mcore_url);mcore.visible=false;mcore.searching=false;mcore.pendingRequest=false;mcore.mediaPerPage=10;mcore.jsonData={limit:mcore.mediaPerPage,include_embed:1};f.ajaxSetup({beforeSend:function(){mcore.loading.show()},complete:function(){mcore.loading.hide()}});mcore.mcoreClose.click(function(){mcore.closeMcoreEmbed()});mcore.mcorePrev.click(function(){mcore.prevPage()});mcore.mcoreNext.click(function(){mcore.nextPage()});mcore.mcoreSearch.focus(function(){if(this.value=="Search"){this.value=""}});mcore.mcoreSearch.blur(function(){if(this.value==""){this.value="Search"}});mcore.mcoreSearch.keyup(function(){if(this.value==""&&mcore.searching){mcore.mcoreClearSearch.hide();h()}});mcore.mcoreClearSearch.click(function(){if(mcore.searching){mcore.mcoreSearch[0].value="";f(this).hide();h()}});mcore.mcoreSearchForm.submit(function(){searchBox=mcore.mcoreSearch[0];if(searchBox.value!=""&&searchBox.value!="Search"&&mcore.state!="connection-error"){query=searchBox.value;mcore.jsonData.search=query;mcore.mcoreNext.removeClass("mcore-disabled");mcore.mcorePrev.addClass("mcore-disabled");mcore.clearContent();e();mcore.currPage=1;mcore.searching=true;mcore.mcoreClearSearch.show()}return false})});mcore.openMcoreEmbed=function(){e();mcore.mcoreOverlay.fadeIn(150);mcore.mcoreEmbed.fadeIn(150);mcore.visible=true;mcore.currPage=1;mcore.mcoreSearch.focus()};mcore.closeMcoreEmbed=function(){mcore.mcoreOverlay.fadeOut("fast");mcore.mcoreEmbed.fadeOut("fast");mcore.visible=false;mcore.mcoreEmbed.removeClass("zero-state");mcore.mcoreEmbed.removeClass("connection-error");mcore.clearContent()};mcore.prevPage=function(){if(mcore.currPage!=1&&mcore.state!="connection-error"&&mcore.pendingRequest==false){mcore.clearContent();mcore.jsonData.offset=(mcore.currPage-2)*mcore.mediaPerPage;e();delete mcore.jsonData.offset;mcore.currPage--}};mcore.nextPage=function(){if(mcore.currPage!=mcore.totalPages&&mcore.state!="connection-error"&&mcore.pendingRequest==false){mcore.clearContent();mcore.jsonData.offset=mcore.currPage*mcore.mediaPerPage;e();delete mcore.jsonData.offset;mcore.currPage++}};mcore.renderPage=function(){if(mcore.mediaRows.length!=0){if(mcore.currPage==mcore.totalPages){mcore.mcoreNext.addClass("mcore-disabled")}else{mcore.mcoreNext.removeClass("mcore-disabled")}if(mcore.totalMedia<mcore.mediaPerPage){mcore.mcoreNext.addClass("mcore-disabled")}if(mcore.currPage==1){mcore.mcorePrev.addClass("mcore-disabled")}else{mcore.mcorePrev.removeClass("mcore-disabled")}mcore.mcoreEmbed.removeClass("zero-state");mcore.mcoreEmbed.removeClass("connection-error");thresh=Math.min(mcore.mediaPerPage,mcore.mediaRows.length);var j=[];for(i=0;i<thresh;i++){j.push(mcore.mediaRows[i].html)}mcore.contentPanel.html(j.join(""));for(i=0;i<thresh;i++){mcore.contentPanel.children("div").click(function(){if(!f(this).hasClass("clicked")){c(this)}})}}else{mcore.mcoreNext.addClass("mcore-disabled");mcore.mcorePrev.addClass("mcore-disabled")}mcore.footer.text("Page "+mcore.currPage+" of "+mcore.totalPages)};mcore.initContent=function(j){mcore.totalMedia=j.count;mcore.totalPages=Math.ceil(mcore.totalMedia/mcore.mediaPerPage);if(mcore.totalPages==0){mcore.totalPages=1;mcore.showMessage("zero-state")}mcore.mediaRows=[];if(mcore.data.media){mediaItems=mcore.data.media;for(i=0;i<mediaItems.length;i++){mcore.mediaRows.push(d(mediaItems[i],i))}}mcore.renderPage()};mcore.clearContent=function(j){mcore.mediaRows=[];mcore.data={};mcore.contentPanel.html("");mcore.mcoreEmbed.removeClass("zero-state");mcore.mcoreEmbed.removeClass("connection-error")};mcore.showMessage=function(j){mcore.clearContent();mcore.mcoreEmbed.addClass(j);header=mcore.message.find("h2");paragraph=mcore.message.find("p");switch(j){case"zero-state":header.text("No media found");paragraph.html("Either you have no media in your MediaCore library, or your search <br />returned no results.");break;case"connection-error":header.text("Unable to connect");paragraph.text("We were unable to establish a connection with the MediaCore site you have entered on the plugin settings page.");break}mcore.mcorePrev.addClass("mcore-disabled");mcore.mcoreNext.addClass("mcore-disabled")};function d(k,j){mediaRow={};mediaRow.media=k;mediaRow.mediaType=(k.type=="video")?"mcore-video":"mcore-audio";mediaRow.thumbnail='<div class="mcore-thumbnail"> 								<img src="'+k.thumbs.s.url+'" /> 								<div class="mcore-overlay"> 									<span class="mcore-length">'+a(k.duration)+' </span> 									<span class="mcore-icon"></span> 								</div> 								<div class="mcore-border"></div> 							</div>';mediaRow.title="<h3>"+k.title+"</h3>";mediaRow.addBtn='<span class="mcore-btn mcore-add-btn"> 							<span><span class="mcore-icon"></span>Add 						</span>';mediaRow.publishDate='<span class="mcore-date">'+g(k.publish_on)+"</span>";mediaRow.html='<div class="mcore-media mcore-clearfix '+mediaRow.mediaType+'" 							id="'+j+'">'+mediaRow.thumbnail+'						<div class="mcore-info">'+mediaRow.title+mediaRow.publishDate+'						</div> 				<div class="mcore-add">'+mediaRow.addBtn+"</div></div>";return mediaRow}function c(j){embed=mcore.mediaRows[j.id].media.embed;tinyMCE.get()[0].execCommand("mceInsertContent",false,embed);j=f(j);j.addClass("clicked");j.children("div").animate({opacity:0.5},{duration:75,queue:false})}function e(){mcore.pendingRequest=true;mcore.currentRequest=f.ajax({url:mcore.url,data:mcore.jsonData,crossDomain:true,dataType:"jsonp",jsonpCallback:"mcorejsonpcallback",timeout:2500,error:function(l,j,k){mcore.showMessage("connection-error");console.log("Error connecting to "+mcore.url);console.log(k);mcore.state="connection-error"},success:function(){mcore.state="connected"}});mcore.currentRequest.done(function(){mcore.pendingRequest=false})}function h(){delete mcore.jsonData.search;mcore.jsonData.offset=0;mcore.currPage=1;mcore.searching=false;mcore.clearContent();e()}function b(j){slash=j.indexOf("/");if(slash!=5&&slash!=6){j="http://"+j}if(j.charAt(j.length-1)!="/"){j+="/api/media"}else{j+="api/media;"}return j}function g(j){temp=j.split(" ");timeString=temp[0]+"T"+temp[1]+"Z";return jQuery.timeago(timeString)}function a(j){hours=null;minutes=Math.floor(j/60);if(minutes>60){hours=Math.floor(minutes/60);seconds=j-(minutes*60)-(hours*360)}else{seconds=j-(minutes*60)}seconds=String("00"+seconds).slice(-2);minutes=String("00"+minutes).slice(-2);if(hours){return hours+":"+minutes+":"+seconds}else{return minutes+":"+seconds}}})(jQuery);function mcorejsonpcallback(a){mcore.data=a;mcore.initContent(a)};